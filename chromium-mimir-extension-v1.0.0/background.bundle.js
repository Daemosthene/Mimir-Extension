/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i,a,c=[],u=!0,s=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(r=i.call(t)).done)&&(c.push(r.value),c.length!==n);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return r(l,"_invoke",function(t,r,o){var i,a,c,s=0,l=o||[],p=!1,g={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(n,t){return i=n,a=0,c=e,g.n=t,u}};function d(t,r){for(a=t,c=r,n=0;!p&&s&&!o&&n<l.length;n++){var o,i=l[n],d=g.p,f=i[2];t>3?(o=f===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=t<2&&d<i[1])?(a=0,g.v=r,g.n=i[1]):d<f&&(o=t<3||i[0]>r||r>f)&&(i[4]=t,i[5]=r,g.n=f,a=0))}if(o||t>1)return u;throw p=!0,r}return function(o,l,f){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&d(l,f),a=l,c=f;(n=a<2?e:c)||!p;){i||(a?a<3?(a>1&&(g.n=-1),d(a,c)):g.n=c:g.v=c);try{if(s=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((n=(p=g.n<0)?c:t.call(r,g))!==u)break}catch(n){i=e,a=1,c=n}finally{s=1}}return{value:n,done:p}}}(t,i,a),!0),l}var u={};function s(){}function l(){}function p(){}n=Object.getPrototypeOf;var g=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),d=p.prototype=s.prototype=Object.create(g);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,r(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=p,r(d,"constructor",p),r(p,"constructor",l),l.displayName="GeneratorFunction",r(p,a,"GeneratorFunction"),r(d),r(d,a,"Generator"),r(d,i,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:f}})()}function r(e,n,t,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,n,t,o){if(n)i?i(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t;else{var a=function(n,t){r(e,n,function(e){return this._invoke(n,t,e)})};a("next",0),a("throw",1),a("return",2)}},r(e,n,t,o)}function o(e,n,t,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function i(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var a=e.apply(n,t);function c(e){o(a,r,i,c,u,"next",e)}function u(e){o(a,r,i,c,u,"throw",e)}c(void 0)})}}var a=["Summarize","Explain Like I'm 5","Translate Text"];function c(e){return u.apply(this,arguments)}function u(){return(u=i(t().m(function e(n){var r;return t().w(function(e){for(;;)if(0===e.n)return r=(new Date).toISOString().split("T")[0],e.a(2,new Promise(function(e){chrome.storage.local.get(["usage","isProUser"],function(t){var o=t.usage,i=void 0===o?{}:o,c=t.isProUser;if(void 0!==c&&c)return e(!0);var u=i[r]||{},s=u[n]||0;a.includes(n)&&s<5?(u[n]=s+1,i[r]=u,chrome.storage.local.set({usage:i},function(){return e(!0)})):e(!1)})}))},e)}))).apply(this,arguments)}function s(){return l.apply(this,arguments)}function l(){return l=i(t().m(function e(){return t().w(function(e){for(;;)switch(e.n){case 0:chrome.storage.local.get("checkoutSessionId",function(){var e=i(t().m(function e(n){var r,o,i,a,c,u,s;return t().w(function(e){for(;;)switch(e.n){case 0:if(r=n.checkoutSessionId){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,fetch("https://mimir-server-daemosthene-mimir-extension.vercel.app/api/verify-subscription?sessionId=".concat(r));case 2:return o=e.v,e.n=3,o.json();case 3:i=e.v,a=i.status,c=i.currentPeriodEnd,u="active"===a,chrome.storage.local.set({isProUser:u}),u&&c&&chrome.alarms.create("renewCheck",{when:1e3*c}),e.n=5;break;case 4:e.p=4,s=e.v,console.error("Failed to verify subscription:",s);case 5:return e.a(2)}},e,null,[[1,4]])}));return function(n){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),l.apply(this,arguments)}chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.create({id:"mimir_menu",title:"Mimir Tools",contexts:["selection","page"]}),["Summarize","Explain Like I’m 5","Citation Finder","Definition","Daily Brief","Socratic Review","Flashcard Generator","Turn Professional","Translate Text"].forEach(function(e){chrome.contextMenus.create({id:e,parentId:"mimir_menu",title:e,contexts:["selection","page"]})}),chrome.storage.local.get("theme",function(e){var n={default:{16:"extensionLogo.png",48:"extensionLogo.png",128:"extensionLogo.png"},red:{16:"red.png",48:"red.png",128:"red.png"},orange:{16:"orange.png",48:"orange.png",128:"orange.png"},darkblue:{16:"darkblue.png",48:"darkblue.png",128:"darkblue.png"},green:{16:"green.png",48:"green.png",128:"green.png"},purple:{16:"purple.png",48:"purple.png",128:"purple.png"},teal:{16:"teal.png",48:"teal.png",128:"teal.png"},yellow:{16:"yellow.png",48:"yellow.png",128:"yellow.png"}},t=n[e.theme||"default"]||n.default;chrome.action.setIcon({path:t},function(){chrome.runtime.lastError&&console.warn("⚠️ Failed to set icon:",chrome.runtime.lastError.message)})})}),chrome.contextMenus.onClicked.addListener(function(){var e=i(t().m(function e(n,r){var o,i,a;return t().w(function(e){for(;;)switch(e.n){case 0:if(i=n.menuItemId,a=null===(o=n.selectionText)||void 0===o?void 0:o.trim(),null!=r&&r.id){e.n=1;break}return e.a(2);case 1:a?c(i).then(function(e){e?chrome.tabs.sendMessage(r.id,{type:"open_sidebar_tool",action:i,text:a}):chrome.tabs.sendMessage(r.id,{type:"open_sidebar_tool",action:"Turn Professional",text:"🔒 This tool requires a Pro subscription. Click 'Go Pro' in the extension popup to unlock."})}):chrome.scripting.executeScript({target:{tabId:r.id},func:function(){return document.body.innerText}},function(e){var n,t=(null==e||null===(n=e[0])||void 0===n?void 0:n.result)||"";c(i).then(function(e){e?chrome.tabs.sendMessage(r.id,{type:"open_sidebar_tool",action:i,text:t}):chrome.tabs.sendMessage(r.id,{type:"open_sidebar_tool",action:"Turn Professional",text:"🔒 This tool requires a Pro subscription. Click 'Go Pro' in the extension popup to unlock."})})});case 2:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}()),chrome.commands.onCommand.addListener(function(){var n=i(t().m(function n(r){var o,i,a,u;return t().w(function(n){for(;;)switch(n.n){case 0:if(o={summarize:"Summarize",explain:"Explain Like I'm 5",cite:"Citation Finder",translate:"Translate Text"}[r]){n.n=1;break}return n.a(2);case 1:return n.n=2,chrome.tabs.query({active:!0,currentWindow:!0});case 2:if(i=n.v,a=e(i,1),null!=(u=a[0])&&u.id){n.n=3;break}return n.a(2);case 3:chrome.scripting.executeScript({target:{tabId:u.id},func:function(){return window.getSelection().toString()}},function(e){var n,t,r=null==e||null===(n=e[0])||void 0===n||null===(n=n.result)||void 0===n?void 0:n.trim();r?(t=r,c(o).then(function(e){e?chrome.tabs.sendMessage(u.id,{type:"open_sidebar_tool",action:o,text:t}):chrome.tabs.sendMessage(u.id,{type:"open_sidebar_tool",action:"Turn Professional",text:"🔒 This tool requires a Pro subscription. Click 'Go Pro' in the extension popup to unlock."})})):chrome.scripting.executeScript({target:{tabId:u.id},func:function(){return document.body.innerText}},function(e){var n,t=(null==e||null===(n=e[0])||void 0===n?void 0:n.result)||"";c(o).then(function(e){e?chrome.tabs.sendMessage(u.id,{type:"open_sidebar_tool",action:o,text:t}):chrome.tabs.sendMessage(u.id,{type:"open_sidebar_tool",action:"Turn Professional",text:"🔒 This tool requires a Pro subscription. Click 'Go Pro' in the extension popup to unlock."})})})});case 4:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()),chrome.runtime.onStartup.addListener(function(){chrome.storage.local.get("theme",function(e){var n={default:{16:"extensionLogo.png",48:"extensionLogo.png",128:"extensionLogo.png"},red:{16:"red.png",48:"red.png",128:"red.png"},orange:{16:"orange.png",48:"orange.png",128:"orange.png"},darkblue:{16:"darkblue.png",48:"darkblue.png",128:"darkblue.png"},green:{16:"green.png",48:"green.png",128:"green.png"},purple:{16:"purple.png",48:"purple.png",128:"purple.png"},teal:{16:"teal.png",48:"teal.png",128:"teal.png"},yellow:{16:"yellow.png",48:"yellow.png",128:"yellow.png"}},t=n[e.theme||"default"]||n.default;chrome.action.setIcon({path:t},function(){chrome.runtime.lastError&&console.warn("⚠️ Failed to set icon on startup:",chrome.runtime.lastError.message)})})}),chrome.runtime.onMessage.addListener(function(e,n,t){if("setIconByTheme"===e.type){console.log("🎨 Received icon change for theme:",e.theme);var r={default:{16:"extensionLogo.png",48:"extensionLogo.png",128:"extensionLogo.png"},red:{16:"red.png",48:"red.png",128:"red.png"},orange:{16:"orange.png",48:"orange.png",128:"orange.png"},darkblue:{16:"darkblue.png",48:"darkblue.png",128:"darkblue.png"},green:{16:"green.png",48:"green.png",128:"green.png"},purple:{16:"purple.png",48:"purple.png",128:"purple.png"},teal:{16:"teal.png",48:"teal.png",128:"teal.png"},yellow:{16:"yellow.png",48:"yellow.png",128:"yellow.png"}},o=r[e.theme||"default"]||r.default;chrome.action.setIcon({path:o},function(){chrome.runtime.lastError&&console.warn("⚠️ Failed to set icon:",chrome.runtime.lastError.message)})}}),chrome.runtime.onInstalled.addListener(s),chrome.runtime.onStartup.addListener(s),chrome.alarms.onAlarm.addListener(function(e){"renewCheck"===e.name&&s()}),chrome.tabs.onUpdated.addListener(function(e,n,t){"complete"===n.status&&t.url&&t.url.startsWith("https://mimir.vercel.app/success")&&s()})})();