/*! For license information please see content.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function l(t,i,o,a){var l=i&&i.prototype instanceof s?i:s,d=Object.create(l.prototype);return n(d,"_invoke",function(t,n,i){var o,a,l,s=0,d=i||[],m=!1,u={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,a=0,l=e,u.n=n,c}};function p(t,n){for(a=t,l=n,r=0;!m&&s&&!i&&r<d.length;r++){var i,o=d[r],p=u.p,f=o[2];t>3?(i=f===n)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=t<2&&p<o[1])?(a=0,u.v=n,u.n=o[1]):p<f&&(i=t<3||o[0]>n||n>f)&&(o[4]=t,o[5]=n,u.n=f,a=0))}if(i||t>1)return c;throw m=!0,n}return function(i,d,f){if(s>1)throw TypeError("Generator is already running");for(m&&1===d&&p(d,f),a=d,l=f;(r=a<2?e:l)||!m;){o||(a?a<3?(a>1&&(u.n=-1),p(a,l)):u.n=l:u.v=l);try{if(s=2,o){if(a||(i="next"),r=o[i]){if(!(r=r.call(o,l)))throw TypeError("iterator result is not an object");if(!r.done)return r;l=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((r=(m=u.n<0)?l:t.call(n,u))!==c)break}catch(t){o=e,a=1,l=t}finally{s=1}}return{value:r,done:m}}}(t,o,a),!0),d}var c={};function s(){}function d(){}function m(){}r=Object.getPrototypeOf;var u=[][o]?r(r([][o]())):(n(r={},o,function(){return this}),r),p=m.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,n(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=m,n(p,"constructor",m),n(m,"constructor",d),d.displayName="GeneratorFunction",n(m,a,"GeneratorFunction"),n(p),n(p,a,"Generator"),n(p,o,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:l,m:f}})()}function n(e,t,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}n=function(e,t,r,i){if(t)o?o(e,t,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[t]=r;else{var a=function(t,r){n(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}},n(e,t,r,i)}function r(e,t,n,r,i,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,i)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function l(){try{return!!(chrome&&chrome.runtime&&chrome.runtime.id)}catch(e){return!1}}function c(e,t){if(!l())return console.warn("Extension context invalidated, using defaults"),void t({});try{chrome.storage.local.get(e,t)}catch(e){console.warn("Storage access failed:",e),t({})}}function s(e,t){if(!l())return console.warn("Extension context invalidated, cannot save data"),void(t&&t());try{chrome.storage.local.set(e,t)}catch(e){console.warn("Storage set failed:",e),t&&t()}}function d(e,t){var n={action:e,text:t};switch(e){case"Summarize":return o(o({},n),{},{mode:"concise",includeKeywords:!0});case"Explain Like I'm 5":return o(o({},n),{},{simplifyLevel:5});case"Citation Finder":return o(o({},n),{},{includeLinks:!0,format:"APA"});case"Definition":return o(o({},n),{},{includeExamples:!0,simplify:!0});case"Daily Brief":return o(o({},n),{},{context:"yesterday",includeTasks:!0});case"Socratic Review":return o(o({},n),{},{questionStyle:"dialectic",depth:"high"});case"Flashcard Generator":return o(o({},n),{},{format:"anki",maxCards:10});case"Turn Professional":return o(o({},n),{},{tone:"professional",polish:!0});case"Translate Text":return o(o({},n),{},{targetLanguage:"en",preserveFormat:!0});default:return n}}var m="right",u=360;function p(e){if(!document.getElementById("mimir-sidebar")){var t=document.createElement("div");t.className="mimir-sidebar ".concat(m),t.id="mimir-sidebar",t.style.width=u+"px",document.body.appendChild(t),c("theme",function(e){var t={default:"#4287f5",red:"#A4262C",orange:"#CA5010",darkblue:"#40587C",green:"#407855",purple:"#8764B8",teal:"#038387",yellow:"#CEA230"},n=t[e.theme||"default"]||t.default;document.documentElement.style.setProperty("--accent-color",n)});var n=document.createElement("div");n.style.display="flex",n.style.justifyContent="space-between",n.style.alignItems="center",n.style.padding="12px 16px",n.style.color="var(--accent-color)",n.style.fontSize="20px",n.style.fontWeight="bold",n.style.flexShrink="0";var r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="8px";var i=document.createElement("img");i.src=chrome.runtime.getURL("extensionLogo.png"),i.alt="Mimir logo",i.style.width="28px",i.style.height="28px";var o=document.createElement("div");o.textContent="Mimir",o.className="mimir-sidebar-title",o.style.margin="0",r.appendChild(i),r.appendChild(o);var a=document.createElement("button");a.textContent="âœ–",a.style.border="none",a.style.background="none",a.style.color="var(--accent-color)",a.style.fontSize="16px",a.style.cursor="pointer",a.style.margin="0",a.style.padding="0",a.onclick=function(){t.remove(),document.body.style.marginRight="",document.body.style.marginLeft=""},n.appendChild(r),n.appendChild(a),t.appendChild(n);var l=document.createElement("h3");l.id="mimir-sidebar-title",l.style.margin="10px",t.appendChild(l);var s=document.createElement("div");s.className="mimir-sidebar-results",s.id="mimir-sidebar-content",t.appendChild(s);var d=document.createElement("div");d.className="mimir-spinner",d.id="mimir-sidebar-spinner",d.style.display="none",t.appendChild(d);var p=document.createElement("button");p.className="mimir-toggle-btn",p.id="mimir-toggle-btn",p.textContent="right"===m?"<":">",p.onclick=function(){t.classList.remove("open"),document.body.style.marginLeft="",document.body.style.marginRight="",setTimeout(function(){m="right"===m?"left":"right",t.className="mimir-sidebar ".concat(m),t.style.width=u+"px",p.textContent="right"===m?"<":">",document.body.style["right"===m?"marginRight":"marginLeft"]=u+"px"},300)},t.appendChild(p);var f=document.createElement("div");f.className="mimir-resizer ".concat(m),t.appendChild(f);var y=0,g=function(e){requestAnimationFrame(function(){var n="right"===m?y-e.clientX:e.clientX-y;u=Math.max(200,Math.min(600,u+n)),t.style.width=u+"px",document.body.style["right"===m?"marginRight":"marginLeft"]=u+"px",y=e.clientX})};f.addEventListener("mousedown",function(e){y=e.clientX,document.body.style.userSelect="none",document.addEventListener("mousemove",g),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",g),document.body.style.userSelect=""},{once:!0})}),document.body.style["right"===m?"marginRight":"marginLeft"]=u+"px",t.classList.add("open"),e&&e()}}function f(e,n){console.log("Running:",e),c(null,function(e){console.log("Storage data:",e)});var i=document.getElementById("mimir-sidebar-title"),a=document.getElementById("mimir-sidebar-content"),l=document.getElementById("mimir-sidebar-spinner");i&&a&&l?(i.textContent=e,a.textContent="",l.style.display="block",c(["usage","isProUser"],function(){var i,m=(i=t().m(function r(i){var m,u,p,f,y,g,h,v,b,x,w,E,C,S,k,T;return t().w(function(t){for(;;)switch(t.n){case 0:if(u=i.usage,p=void 0===u?{}:u,f=i.isProUser,y=void 0!==f&&f,g=(new Date).toISOString().split("T")[0],h=(null===(m=p[g])||void 0===m?void 0:m[e])||0,v=["Summarize","Explain Like I'm 5","Translate Text"].includes(e),y||v&&!(h>=5)){t.n=1;break}return l.style.display="none",a.textContent="ðŸ”’ This tool requires Pro. Click Go Pro to upgrade.",t.a(2);case 1:return!y&&v&&((b=o({},p))[g]=b[g]||{},b[g][e]=h+1,s({usage:b})),t.p=2,t.n=3,fetch("https://mimir-server-daemosthene-mimir-extension.vercel.app/api/mimir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d(e,n))});case 3:return x=t.v,t.n=4,x.json();case 4:w=t.v,l.style.display="none",E=w.result||w.error||"No result.",(C=document.createElement("div")).style.whiteSpace="pre-wrap",(S=document.createElement("div")).textContent=E,S.style.marginBottom="12px",(k=document.createElement("div")).style.marginTop="10px",k.style.fontSize="14px",k.style.color="#ccc",k.style.whiteSpace="pre-wrap",c(["usage","isProUser"],function(t){var n,r=(new Date).toISOString().split("T")[0],i=(null===(n=t.usage)||void 0===n||null===(n=n[r])||void 0===n?void 0:n[e])||0,o=["Summarize","Explain Like I'm 5","Translate Text"].includes(e);!t.isProUser&&o?(k.textContent="ðŸ§® ".concat(i,"/5 free uses today"),C.appendChild(k),C.appendChild(S)):C.appendChild(S),a.innerHTML="",a.appendChild(C)}),t.n=6;break;case 5:t.p=5,T=t.v,l.style.display="none",a.textContent="Error: ".concat(T.message||"Failed to fetch.");case 6:return t.a(2)}},r,null,[[2,5]])}),function(){var e=this,t=arguments;return new Promise(function(n,o){var a=i.apply(e,t);function l(e){r(a,n,o,l,c,"next",e)}function c(e){r(a,n,o,l,c,"throw",e)}l(void 0)})});return function(e){return m.apply(this,arguments)}}())):console.warn("Sidebar elements not found")}if(l())try{chrome.runtime.onMessage.addListener(function(e,t,n){if("open_sidebar_tool"===e.type){var r=e.action,i=e.text,o=function(){var e=new CustomEvent("mimirRunToolManually",{detail:{action:r,text:i}});window.dispatchEvent(e)};document.getElementById("mimir-sidebar")?o():p(o)}})}catch(e){console.warn("Failed to set up message listener:",e)}window.addEventListener("mimirOpenSidebarMode",function(){document.getElementById("mimir-sidebar")||p(function(){document.getElementById("mimir-sidebar");var e=document.getElementById("mimir-sidebar-content");[{name:"Summarize",description:"Get a context-aware summary of the selected text."},{name:"Explain Like I'm 5",description:"Simplify the selected text so a 5-year-old could understand it."},{name:"Translate Text",description:"Translate selected or full-page text from any language into English."},{name:"Definition",description:"Define a selected word or phrase and optionally simplify it."},{name:"Turn Professional",description:"Polish informal writing into professional, work-ready prose."},{name:"Socratic Review",description:"Ask critical questions to clarify and challenge your thinking."},{name:"Daily Brief",description:"Summarize yesterday's content and highlight key action items."},{name:"Citation Finder",description:"Suggest sources or references related to the selected content."},{name:"Flashcard Generator",description:"Turn notes or articles into tab-separated, Anki-compatible flashcards."}].forEach(function(t){var n=document.createElement("div");n.style.padding="6px 0";var r=document.createElement("div");r.style.display="flex",r.style.alignItems="center";var i=document.createElement("button");i.textContent="â€º",i.style.border="none",i.style.background="var(--accent-color)",i.style.color="white",i.style.cursor="pointer",i.style.marginRight="6px",i.style.padding="6px 10px",i.style.borderRadius="4px",i.style.fontSize="14px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.height="36px",i.style.width="36px",i.style.minWidth="36px";var o=document.createElement("button");o.textContent=t.name,o.style.flexGrow="1",o.style.border="none",o.style.background="var(--accent-color)",o.style.color="white",o.style.cursor="pointer",o.style.padding="6px 10px",o.style.fontSize="14px",o.style.borderRadius="4px",o.style.height="36px";var a=document.createElement("div");a.className="mimir-spinner",a.style.display="none";var l=document.createElement("div");l.textContent=t.description,l.style.display="none",l.style.fontSize="13px",l.style.marginTop="6px",l.style.color="white",i.onclick=function(){var e="block"===l.style.display;l.style.display=e?"none":"block",i.textContent=e?"â€º":"Ë…"},o.onclick=function(){var e=Array.from(document.querySelectorAll('[contenteditable="true"], textarea')).map(function(e){return e.value||e.innerText||""}).filter(function(e){return e.trim()}).join("\n\n")||document.body.innerText;f(t.name,e)},r.appendChild(i),r.appendChild(o),n.appendChild(r),n.appendChild(l),n.appendChild(a),e.appendChild(n)})})}),function(){var e="mimir-drift-style";if(!document.getElementById(e)){var t=document.createElement("style");t.id=e,t.textContent="\n    .mimir-sidebar {\n      position: fixed;\n      top: 0;\n      height: 100%;\n      width: 360px;\n      background: #1F1F1F;\n      color: #ffffff;\n      box-shadow: 0 0 8px #000000;\n      display: flex;\n      flex-direction: column;\n      z-index: 99999;\n      transition: transform 0.3s ease;\n    }\n\n    .mimir-sidebar.left { left: 0; }\n    .mimir-sidebar.right { right: 0; }\n\n    .mimir-close-btn {\n      border: none;\n      background: none;\n      font-size: 16px;\n      align-self: flex-end;\n      margin: 8px;\n      cursor: pointer;\n    }\n\n    .mimir-toggle-btn {\n      border: none;\n      background: none;\n      font-size: 16px;\n      cursor: pointer;\n      margin: 8px auto;\n      margin-top: auto;\n    }\n\n    .mimir-resizer {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 6px;\n      background: #ddd;\n      cursor: ew-resize;\n      z-index: 100000;\n    }\n\n    .mimir-resizer.left { right: 0; }\n    .mimir-resizer.right { left: 0; }\n\n    .mimir-tool-button {\n      padding: 6px 10px;\n      margin: 4px 0;\n      border: none;\n      background: var(--accent-color);\n      color: white;\n      cursor: pointer;\n      font-size: 14px;\n      text-align: left;\n      border-radius: 4px;\n    }\n\n    .mimir-spinner {\n      border: 4px solid #ccc;\n      border-top: 4px solid var(--accent-color);\n      border-radius: 50%;\n      width: 20px;\n      height: 20px;\n      animation: spin 1s linear infinite;\n      margin: 10px auto;\n    }\n\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    .mimir-sidebar-results {\n      padding: 10px;\n      font-size: 18px;\n      overflow-y: auto;\n      white-space: pre-wrap;\n    }\n    @font-face {\n        font-family: 'norse.bold.otf';\n        src: url(".concat(function(){if(!l())return"data:font/opentype;base64,";try{return chrome.runtime.getURL("norse.bold.otf")}catch(e){return console.warn("Runtime getURL failed:",e),"data:font/opentype;base64,"}}(),") format(\"opentype\");\n      }\n    .mimir-sidebar-title {\n      font-family: 'norse.bold.otf', sans-serif;\n      font-size: 30px;\n      font-weight: normal;\n      margin: 0;\n      padding: 0;\n      color: var(--accent-color);\n    }          \n  "),document.head.appendChild(t)}}(),window.addEventListener("mimirRunToolManually",function(e){var t=null==e?void 0:e.detail;if(t&&t.action&&t.text){var n=t.action,r=t.text;console.log("Received mimirRunToolManually event:",t),f(n,r)}else console.warn("Invalid event detail for mimirRunToolManually:",e)})})();