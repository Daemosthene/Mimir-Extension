/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof u?o:u,l=Object.create(c.prototype);return n(l,"_invoke",function(t,n,o){var i,a,c,u=0,l=o||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return i=t,a=0,c=e,m.n=n,s}};function f(t,n){for(a=t,c=n,r=0;!d&&u&&!o&&r<l.length;r++){var o,i=l[r],f=m.p,p=i[2];t>3?(o=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((o=t<2&&f<i[1])?(a=0,m.v=n,m.n=i[1]):f<p&&(o=t<3||i[0]>n||n>p)&&(i[4]=t,i[5]=n,m.n=p,a=0))}if(o||t>1)return s;throw d=!0,n}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,p),a=l,c=p;(r=a<2?e:c)||!d;){i||(a?a<3?(a>1&&(m.n=-1),f(a,c)):m.n=c:m.v=c);try{if(u=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((r=(d=m.n<0)?c:t.call(n,m))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:r,done:d}}}(t,i,a),!0),l}var s={};function u(){}function l(){}function d(){}r=Object.getPrototypeOf;var m=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),f=d.prototype=u.prototype=Object.create(m);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,n(f,"constructor",d),n(d,"constructor",l),l.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(f),n(f,a,"Generator"),n(f,i,function(){return this}),n(f,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:p}})()}function n(e,t,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}n=function(e,t,r,o){if(t)i?i(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r;else{var a=function(t,r){n(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}},n(e,t,r,o)}function r(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function c(e){r(a,o,i,c,s,"next",e)}function s(e){r(a,o,i,c,s,"throw",e)}c(void 0)})}}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function s(e,t){var n={action:e,text:t};switch(e){case"Summarize":return a(a({},n),{},{mode:"concise",includeKeywords:!0});case"Explain Like I'm 5":return a(a({},n),{},{simplifyLevel:5});case"Citation Finder":return a(a({},n),{},{includeLinks:!0,format:"APA"});case"Definition":return a(a({},n),{},{includeExamples:!0,simplify:!0});case"Daily Brief":return a(a({},n),{},{context:"yesterday",includeTasks:!0});case"Socratic Review":return a(a({},n),{},{questionStyle:"dialectic",depth:"high"});case"Flashcard Generator":return a(a({},n),{},{format:"anki",maxCards:10});case"Turn Professional":return a(a({},n),{},{tone:"professional",polish:!0});case"Translate Text":return a(a({},n),{},{targetLanguage:"en",preserveFormat:!0});default:return n}}var u={default:"#4287f5",red:"#A4262C",orange:"#CA5010",darkblue:"#40587C",green:"#407855",purple:"#8764B8",teal:"#038387",yellow:"#CEA230"};function l(e){var t=u[e]||u.default;document.documentElement.style.setProperty("--accent-color",t)}chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e.theme&&l(e.theme.newValue)}),chrome.runtime.onMessage.addListener(function(e){"themeChanged"===e.type&&e.theme&&l(e.theme)}),chrome.runtime.onMessage.addListener(function(e){if("themeChanged"===e.type){var t={default:"#4287f5",red:"#A4262C",orange:"#CA5010",darkblue:"#40587C",green:"#407855",purple:"#8764B8",teal:"#038387",yellow:"#CEA230"},n=t[e.theme]||t.default;document.documentElement.style.setProperty("--accent-color",n)}}),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e.theme&&l(e.theme.newValue)}),chrome.runtime.onMessage.addListener(function(e,t){"themeChanged"===e.type&&e.theme&&l(e.theme)}),document.getElementById("toolsView");var d=document.getElementById("buttons"),m={};[{name:"Summarize",description:"Get a context-aware summary of the selected text."},{name:"Explain Like I'm 5",description:"Simplify the selected text so a 5-year-old could understand it."},{name:"Translate Text",description:"Translate selected or full-page text from any language into English."},{name:"Definition",description:"Define a selected word or phrase and optionally simplify it."},{name:"Turn Professional",description:"Polish informal writing into professional, work-ready prose."},{name:"Socratic Review",description:"Ask critical questions to clarify and challenge your thinking."},{name:"Daily Brief",description:"Summarize yesterday’s notes, list tasks, and suggest what to work on."},{name:"Citation Finder",description:"Suggest sources or references related to the selected content."},{name:"Flashcard Generator",description:"Turn notes or articles into tab-separated, Anki-compatible flashcards."}].forEach(function(e){var n=document.createElement("div");n.className="tool";var r=document.createElement("div");r.className="tool-header";var i=document.createElement("button");i.className="toggle-description",i.textContent="›";var c=document.createElement("button");c.className="action-button",c.textContent=e.name,c.dataset.action=e.name;var u=document.createElement("div");u.className="description",u.textContent=e.description;var l=document.createElement("div");l.className="mimir-spinner",l.style.display="none",l.style.marginTop="5px",r.appendChild(l),i.addEventListener("click",function(){var e=u.classList.contains("open");document.querySelectorAll(".description").forEach(function(e){return e.classList.remove("open")}),document.querySelectorAll(".toggle-description").forEach(function(e){return e.textContent="›"}),e||(u.classList.add("open"),i.textContent="˅")}),c.addEventListener("click",function(){l.style.display="inline-block",chrome.tabs.query({active:!0,currentWindow:!0},function(n){chrome.scripting.executeScript({target:{tabId:n[0].id},func:function(){return window.getSelection().toString()}},function(){var r=o(t().m(function r(i){var c,u,d,f;return t().w(function(r){for(;;)switch(r.n){case 0:if(u=null===(c=i[0])||void 0===c||null===(c=c.result)||void 0===c?void 0:c.trim(),d=e.name,f=!["Definition"].includes(d),u){r.n=1;break}return f?m[d]?chrome.scripting.executeScript({target:{tabId:n[0].id},func:function(){return document.body.innerText}},function(){var n=o(t().m(function n(r){var i,c,u,d,m;return t().w(function(n){for(;;)switch(n.n){case 0:c=null===(i=r[0])||void 0===i||null===(i=i.result)||void 0===i?void 0:i.trim(),u=e.name,d=["Summarize","Explain Like I'm 5","Translate Text"].includes(u),m=(new Date).toISOString().split("T")[0],chrome.storage.local.get(["usage","isProUser"],function(){var e=o(t().m(function e(n){var r,o,i,f,p,y,h,g,v;return t().w(function(e){for(;;)switch(e.n){case 0:if(o=n.usage,i=void 0===o?{}:o,f=n.isProUser,p=void 0!==f&&f,y=(null===(r=i[m])||void 0===r?void 0:r[u])||0,p||d&&!(y>=5)){e.n=1;break}return document.getElementById("result").innerText="🔒 This tool requires Pro. Click Go Pro to upgrade.",l.style.display="none",e.a(2);case 1:return!p&&d&&((h=a({},i))[m]=h[m]||{},h[m][u]=y+1,chrome.storage.local.set({usage:h})),e.n=2,fetch("https://mimir-server-daemosthene-mimir-extension.vercel.app/api/mimir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s(u,c))});case 2:return g=e.v,e.n=3,g.json();case 3:v=e.v,chrome.storage.local.get(["usage","isProUser"],function(e){var t,n=(new Date).toISOString().split("T")[0],r=(null===(t=e.usage)||void 0===t||null===(t=t[n])||void 0===t?void 0:t[u])||0,o=["Summarize","Explain Like I'm 5","Translate Text"].includes(u),i="";!e.isProUser&&o&&(i="\n\n🧮 ".concat(r,"/5 free uses today")),document.getElementById("result").innerText=i+"\n\n"+(v.result||"No response.")}),l.style.display="none";case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()):(m[d]=!0,document.getElementById("result").innerText="Please select some text first or press again to ".concat(d.toLowerCase()," the entire page."),l.style.display="none"):(document.getElementById("result").innerText="Please select some text first.",l.style.display="none"),r.a(2);case 1:m[d]=!1,chrome.storage.local.get(["usage","isProUser"],function(){var e=o(t().m(function e(n){var r,o,i,c,m,f,p,y,h,g,v;return t().w(function(e){for(;;)switch(e.n){case 0:if(o=n.usage,i=void 0===o?{}:o,c=n.isProUser,m=void 0!==c&&c,f=(new Date).toISOString().split("T")[0],p=(null===(r=i[f])||void 0===r?void 0:r[d])||0,y=["Summarize","Explain Like I'm 5","Translate Text"].includes(d),m||y&&!(p>=5)){e.n=1;break}return document.getElementById("result").innerText="🔒 This tool requires Pro. Click Go Pro to upgrade.",l.style.display="none",e.a(2);case 1:return!m&&y&&((h=a({},i))[f]=h[f]||{},h[f][d]=p+1,chrome.storage.local.set({usage:h})),e.n=2,fetch("https://mimir-server-daemosthene-mimir-extension.vercel.app/api/mimir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s(d,u))});case 2:return g=e.v,e.n=3,g.json();case 3:v=e.v,chrome.storage.local.get(["usage","isProUser"],function(e){var t,n=(new Date).toISOString().split("T")[0],r=(null===(t=e.usage)||void 0===t||null===(t=t[n])||void 0===t?void 0:t[d])||0,o=["Summarize","Explain Like I'm 5","Translate Text"].includes(d),i="";!e.isProUser&&o&&(i="\n\n🧮 ".concat(r,"/5 free uses today")),document.getElementById("result").innerText=i+"\n\n"+(v.result||"No response.")}),l.style.display="none";case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}())})}),r.appendChild(i),r.appendChild(c),n.appendChild(r),n.appendChild(u),d.appendChild(n)}),window.addEventListener("DOMContentLoaded",function(){chrome.storage.local.get("theme",function(e){l(e.theme||"default")});var e=document.getElementById("goProBtn");e?(console.log("✅ Go Pro button found"),e.addEventListener("click",function(){console.log("🚀 Go Pro button clicked"),fetch("https://mimir-server-daemosthene-mimir-extension.vercel.app/api/create-checkout",{method:"POST"}).then(function(e){return e.json()}).then(function(e){console.log("🚀 create-checkout response:",e),e.url&&e.sessionId?(chrome.storage.local.set({checkoutSessionId:e.sessionId}),window.open(e.url,"_blank")):alert("Checkout failed. Response was: ".concat(JSON.stringify(e)))}).catch(function(e){console.error("❌ Stripe fetch failed:",e),alert("Error contacting checkout server.")})})):console.error("❌ Go Pro button not found in DOM.");var t=document.getElementById("openSettings");t&&t.addEventListener("click",function(){chrome.windows.create({url:chrome.runtime.getURL("settings.html"),type:"popup",width:400,height:520})});var n=document.getElementById("sidebarModeBtn");function r(){var e=document.getElementById("resetMessage");if(e){var t=new Date,n=new Date;n.setHours(24,0,0,0);var r=n-t,o=Math.floor(r/1e3/60/60),i=Math.floor(r/1e3/60%60);e.textContent="Free uses reset in ".concat(o,"h ").concat(i,"m")}}n&&n.addEventListener("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.scripting.executeScript({target:{tabId:e[0].id},func:function(){window.dispatchEvent(new CustomEvent("mimirOpenSidebarMode"))}}),window.close()})}),r(),setInterval(r,6e4)}),chrome.storage.local.get("isProUser",function(e){var t=e.isProUser,n=document.getElementById("goProBtn");t&&n&&(n.style.display="none");var r=document.getElementById("resetMessage");t?r&&(r.style.display="none"):(updateResetTimer(),setInterval(updateResetTimer,6e4))})})();